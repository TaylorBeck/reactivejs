<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReactiveJS</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>ReactiveJS: To Do List</h1>

  <div id="app"></div>

  <script src="reactive.js"></script>
  <script>
    // Initialize the app
    app.createState({
      tasks: [
      { id: 1, text: "Create ReactiveJS", completed: false },
      { id: 2, text: "Build a todo app", completed: false },
      { id: 3, text: "Become the best", completed: false }
      ],
      newTask: ""
    });
    
    // Computed property
    app.computed('completedCount', state => 
      state.tasks.filter(task => task.completed).length
    );
    
    // Component template
    const todoTemplate = `
      <div>
          <input type="text" id="newTask" data-bind="newTask">
          <button id="addTask">Add Task</button>
          <ul>
              {{tasks}}
          </ul>
          <p>Completed tasks: <span data-bind="completedCount"></span></p>
      </div>
    `;

    const renderTodo = app.component('#app', todoTemplate, {
      tasks: app.state.tasks,
      completedCount: app.state.completedCount
    });
    
    // Event listeners
    app.on('click', '#addTask', () => {
      if (app.state.newTask.trim()) {
        app.state.tasks.push({
          id: Date.now(),
          text: app.state.newTask,
          completed: false
        });
        app.state.newTask = "";
        renderTodo();
      }
    });
    
    app.on('keyup', '#newTask', (e) => {
      if (e.key === 'Enter') {
        document.querySelector('#addTask').click();
      }
    });
    
    // Bind and format
    app.bind('#app', 'tasks', tasks => 
      tasks.map(task => `
        <li class="task ${task.completed ? 'completed' : ''}" data-id="${task.id}">
            <input type="checkbox" ${task.completed ? 'checked' : ''}>
            <span>${task.text}</span>
            <button class="delete">Delete</button>
        </li>
    `).join(''));
    
    // Event delegation for dynamic elements
    document.querySelector('#app').addEventListener('click', (e) => {
      if (e.target.matches('input[type="checkbox"]')) {
        const taskId = parseInt(e.target.closest('.task').dataset.id);
        const task = app.state.tasks.find(t => t.id === taskId);
        
        console.log(task);
        
        
        if (task) {
          task.completed = e.target.checked;
          app.state.tasks = [...app.state.tasks];
        }
      } else if (e.target.matches('.delete')) {
        const taskId = parseInt(e.target.closest('.task').dataset.id);
        
        console.log(taskId);
        
        
        app.state.tasks = app.state.tasks.filter(t => t.id !== taskId);
        renderTodo();
      }
    });
  </script>
</body>
</html>
